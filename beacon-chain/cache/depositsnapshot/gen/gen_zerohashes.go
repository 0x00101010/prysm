package main

import (
	"crypto/sha256"
	"fmt"
	"log"
	"os"
	"strings"
	"text/template"

	"github.com/prysmaticlabs/prysm/v3/beacon-chain/cache/depositsnapshot"
)

var tpl = `// Code generated by gen_zerohashes. DO NOT EDIT.
package {{ .Package }}

var Zerohashes = [][32]byte{
{{- range .Zerohashes }}
	// {{ . | printf "%x" }}
	{ {{- . | join -}} },
{{- end }}
}
`

func join(a [32]byte) string {
	var buff strings.Builder
	buff.Grow(32 * (2 + 3))
	buff.WriteString(fmt.Sprintf("%d", a[0]))
	for _, b := range a[1:] {
		buff.WriteString(fmt.Sprintf(", %d", b))
	}
	return buff.String()
}

func main() {
	x := [32]byte{152, 94, 146, 159, 112, 175, 40, 208, 189, 209, 169, 10, 128, 143, 151, 127, 89, 124, 124, 119, 140, 72, 158, 152, 211, 189, 137, 16, 211, 26, 192, 247}
	fmt.Printf("%x\n", x)
	zerohashes := make([][32]byte, 1, depositsnapshot.DepositContractDepth)
	fmt.Printf("%x\n", zerohashes[0])
	for i := 1; i < depositsnapshot.DepositContractDepth; i++ {
		zerohashes = append(zerohashes, sha256.Sum256(append(zerohashes[i-1][:], zerohashes[i-1][:]...)))
		fmt.Printf("%x\n", zerohashes[i])
	}

	tmpl, err := template.New("zerohashes").Funcs(map[string]any{"join": join}).Parse(tpl)
	if err != nil {
		log.Fatal(err)
	}

	file, err := os.Create("/home/sammy/prysmaticLabs/prysm/beacon-chain/cache/depositsnapshot/zerohashes.gen.go")
	if err != nil {
		log.Fatal(err)
	}
	defer file.Close()

	tmpl.Execute(file, struct {
		Package    string
		Zerohashes [][32]byte
	}{
		Package:    "depositsnapshot",
		Zerohashes: zerohashes,
	})
}
